# Thumbor Configuration - Optimized
# Cloudinary-compatible image CDN

################################################################################
# Security
################################################################################

ALLOW_UNSAFE_URL = True

ALLOWED_SOURCES = [
    r'interioricons\.com',
    r'assets\.tina\.io',
    r'old\.mobelaris\.com',
    r'cdn\.shopify\.com',
    r'merakiweddingplanner\.com',
    r'strapi\.merakiweddingplanner\.com',
]

################################################################################
# Image Loading
################################################################################

LOADER = 'thumbor.loaders.http_loader'
HTTP_LOADER_CONNECT_TIMEOUT = 10
HTTP_LOADER_REQUEST_TIMEOUT = 120  # 2 min for large files
HTTP_LOADER_MAX_BODY_SIZE = 104857600  # 100MB
HTTP_LOADER_FOLLOW_REDIRECTS = True
HTTP_LOADER_MAX_REDIRECTS = 5

################################################################################
# Source Image Storage (cache original images)
################################################################################

STORAGE = 'thumbor.storages.file_storage'
STORAGE_EXPIRATION_SECONDS = 0  # Never expire
FILE_STORAGE_ROOT_PATH = '/data/storage'

################################################################################
# Result Storage (cache processed images)
################################################################################

RESULT_STORAGE = 'thumbor.result_storages.file_storage'
RESULT_STORAGE_FILE_STORAGE_ROOT_PATH = '/data/result_storage'
RESULT_STORAGE_EXPIRATION_SECONDS = 0  # Never expire
RESULT_STORAGE_STORES_UNSAFE = True

################################################################################
# Engine
################################################################################

ENGINE = 'thumbor.engines.pil'

################################################################################
# Image Processing & Quality
################################################################################

# Keep quality at 90 as requested
QUALITY = 90

# Auto-convert to modern formats for supporting browsers
AUTO_WEBP = True
AUTO_AVIF = True

# Convert PNGs without transparency to JPG (smaller files)
AUTO_PNG_TO_JPG = True

# Orientation and metadata
RESPECT_ORIENTATION = True
PRESERVE_EXIF_INFO = False

################################################################################
# Size Limits & DoS Protection
################################################################################

MAX_WIDTH = 8192
MAX_HEIGHT = 8192
MAX_PIXELS = 67108864  # ~8192x8192

# Max source file size (100MB)
MAX_SOURCE_SIZE = 104857600  # 100MB in bytes

################################################################################
# Optimizers (additional compression)
################################################################################

OPTIMIZERS = [
    'thumbor.optimizers.jpegtran',
]

################################################################################
# Filters
################################################################################

FILTERS = [
    'thumbor.filters.brightness',
    'thumbor.filters.contrast',
    'thumbor.filters.convolution',
    'thumbor.filters.cover',
    'thumbor.filters.fill',
    'thumbor.filters.focal',
    'thumbor.filters.format',
    'thumbor.filters.grayscale',
    'thumbor.filters.max_bytes',
    'thumbor.filters.no_upscale',
    'thumbor.filters.noise',
    'thumbor.filters.quality',
    'thumbor.filters.rgb',
    'thumbor.filters.rotate',
    'thumbor.filters.round_corner',
    'thumbor.filters.sharpen',
    'thumbor.filters.strip_exif',
    'thumbor.filters.strip_icc',
    'thumbor.filters.trim',
    'thumbor.filters.upscale',
    'thumbor.filters.watermark',
]

################################################################################
# Logging
################################################################################

THUMBOR_LOG_LEVEL = 'WARNING'
THUMBOR_LOG_FORMAT = '%(asctime)s %(name)s:%(levelname)s %(message)s'
